{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Mission Control Event Schema",
  "description": "Schema for all events flowing through Mission Control",
  "version": "1.0.0",

  "definitions": {
    "event_types": {
      "enum": [
        "task.created",
        "task.updated",
        "task.assigned",
        "task.unassigned",
        "task.status_changed",
        "task.priority_changed",
        "task.commented",
        "task.completed",
        "task.blocked",
        "task.deleted",
        "agent.registered",
        "agent.status_changed",
        "agent.mentioned",
        "agent.task_claimed",
        "human.status_changed",
        "human.mentioned",
        "queue.job_started",
        "queue.job_completed",
        "queue.job_failed",
        "message.received",
        "message.sent",
        "system.heartbeat",
        "system.sync_requested"
      ]
    },

    "channel_types": {
      "enum": ["telegram", "whatsapp", "slack", "discord", "email", "webhook", "dashboard"]
    },

    "entity_reference": {
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "type": { "enum": ["agent", "human", "system"] },
        "name": { "type": "string" },
        "channel": { "$ref": "#/definitions/channel_types" }
      },
      "required": ["id", "type"]
    },

    "task_reference": {
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "title": { "type": "string" },
        "status": { "type": "string" },
        "priority": { "type": "string" },
        "assignee": { "type": ["string", "null"] }
      },
      "required": ["id", "title"]
    }
  },

  "type": "object",
  "properties": {
    "event_id": {
      "type": "string",
      "description": "Unique identifier for this event"
    },
    "event": {
      "$ref": "#/definitions/event_types",
      "description": "Type of event"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "When the event occurred"
    },
    "source": {
      "$ref": "#/definitions/channel_types",
      "description": "Where the event originated"
    },
    "actor": {
      "$ref": "#/definitions/entity_reference",
      "description": "Who triggered the event"
    },
    "recipients": {
      "type": "array",
      "items": { "type": "string" },
      "description": "List of entity IDs who should be notified"
    },
    "data": {
      "type": "object",
      "description": "Event-specific payload"
    },
    "task": {
      "$ref": "#/definitions/task_reference",
      "description": "Related task (if applicable)"
    },
    "message": {
      "type": "string",
      "description": "Human-readable message for notifications"
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata",
      "properties": {
        "correlation_id": { "type": "string" },
        "reply_to": { "type": "string" },
        "thread_id": { "type": "string" }
      }
    }
  },
  "required": ["event_id", "event", "timestamp", "source"]
}
